'use strict';

var child   = require('child_process');
var clc     = require('cli-color');

child.exec('git diff-index --name-only HEAD', function (err, stdout, stderr) {

	if(stdout.indexOf('public/') > -1){

		console.log(clc.green.bold.underline('\nRunning hook \'grunt optimize\'\n'));

		child.spawn('grunt', ['optimize'], {stdio:'inherit'}).on('close', function (code) {

			if (code !== 0) {

				console.log(clc.red.bold('There was an error running the hook \'grunt optimize\''));
				console.log(clc.red.bold('Please check the log or run \'grunt optimize\' to see the output'));

				{{#unless preventExit}}
					process.exit(code);
				{{/unless}}

			} else {

				child.exec('git add public/.', function (err, stdout, stderr) {

					if(!err){

						console.log(clc.green.bold('Hook \'grunt optimize\' without errors'));

					} else {

						console.log(clc.red.bold('There was an error running the hook \'grunt optimize\''));

					}

				});

			}

		});

	}

});